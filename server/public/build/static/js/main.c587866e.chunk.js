(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{131:function(e,t){},142:function(e,t,n){},146:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(17),c=n.n(r),o=n(148),s=n(137),m=n(2),l=n(8),f=n(74),u=n.n(f),h=n(75),d=n.n(h),v=n(14),g=n.n(v),w=n(27),b=n(80),p=n(147),y=n(151),O=function(e,t,n){var a=new ArrayBuffer(44),i=new DataView(a);return i.setUint8(0,"R".charCodeAt(0)),i.setUint8(1,"I".charCodeAt(0)),i.setUint8(2,"F".charCodeAt(0)),i.setUint8(3,"F".charCodeAt(0)),i.setUint32(4,e.byteLength/2+44,!0),i.setUint8(8,"W".charCodeAt(0)),i.setUint8(9,"A".charCodeAt(0)),i.setUint8(10,"V".charCodeAt(0)),i.setUint8(11,"E".charCodeAt(0)),i.setUint8(12,"f".charCodeAt(0)),i.setUint8(13,"m".charCodeAt(0)),i.setUint8(14,"t".charCodeAt(0)),i.setUint8(15," ".charCodeAt(0)),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,t,!0),i.setUint32(24,n,!0),i.setUint32(28,1*n*2),i.setUint16(32,2*t),i.setUint16(34,16,!0),i.setUint8(36,"d".charCodeAt(0)),i.setUint8(37,"a".charCodeAt(0)),i.setUint8(38,"t".charCodeAt(0)),i.setUint8(39,"a".charCodeAt(0)),i.setUint32(40,e.byteLength,!0),function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}(a,e)},D=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32768,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return new Promise(function(c){t.fftSize=a,e.decodeAudioData(O(n,r,i),function(n){var a=e.createBufferSource();a.buffer=n,a.connect(t);var i=t.fftSize,r=new Uint8Array(i);t.getByteTimeDomainData(r),a.start(),c(r)})})},x=function(e,t,n,a,i){t.fillStyle=i.fillStyle,t.fillRect(0,0,n,a),t.lineWidth=i.lineWidth,t.strokeStyle=i.strokeStyle,t.beginPath();for(var r=e.length,c=1*n/r,o=0,s=0;s<r;s++){var m=e[s]/128*a/2;0===s?t.moveTo(o,m):t.lineTo(o,m),o+=c}t.lineTo(n,a/2),t.stroke()},R=Object(l.c)(Object(m.b)(Object(l.b)("store"),Object(m.a)(function(e){var t=e.navigatorMicStream;return p.a(t)},m.f),Object(m.h)(function(e){var t=e.color,n=e.store,a=(n.spectrumInfo,n.config);return{styles:{fillStyle:"white",strokeStyle:t,lineWidth:1},fftSize:32768,rate:a.mic.rate,channels:a.mic.channels,sinewaveScale:a.sinewaveScale,chunkCount:30}}),Object(m.j)("imgUrl","setImgUrl"),Object(m.j)("imgUrls","setImgUrls",[]),Object(m.g)({changeUrls:function(e){var t=e.setImgUrls,n=e.imgUrls,a=e.chunkCount;return function(e){a===n.length&&n.pop();var i=[e].concat(Object(b.a)(n));t(i)}}}),Object(m.c)({componentDidMount:function(){var e=Object(w.a)(g.a.mark(function e(){var t,n,a,i,r,c,o,s,m,l,f,u,h,d,v=this;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.navigatorMicStream,a=t.fftSize,i=t.rate,r=t.channels,c=t.sinewaveScale,t.setImgUrl,o=t.changeUrls,s=new(window.AudioContext||window.webkitAudioContext),m=s.createAnalyser(),l=document.querySelector(".sinewave"),f=l.width,u=l.height,(h=l.getContext("2d")).clearRect(0,0,l.width,l.height),d=null,n.on("data",function(){var e=Object(w.a)(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(s,m,t,a,i,r,c);case 2:n=e.sent,x(n,h,f,u,v.props.styles),d=d||setInterval(function(){var e=l.toDataURL();o(e)},a/i*1e3);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}),Object(m.d)(o.a({sineWaveHeight:s.a(["store","windowInfo","sineWaveHeight"]),sineWaveWidth:s.a(["store","windowInfo","sineWaveWidth"]),wavesCount:s.a(["wavesCount"]),imgUrl:s.a(["imgUrl"]),imgUrls:s.a(["imgUrls"]),chunkCount:s.a(["chunkCount"])})))(function(e){var t=e.sineWaveHeight,n=e.sineWaveWidth,a=e.chunkCount,r=e.imgUrls;return i.a.createElement("div",{className:"d-flex flex-row"},y.a(1,a+1).map(function(e){return r[a-e]&&i.a.createElement("img",{src:r[a-e],key:"image-".concat(e),width:n/(a+1),height:t})}),i.a.createElement("canvas",{className:"sinewave",width:n/(a+1),height:t}))})),j=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2048,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return new Promise(function(c){t.fftSize=a,e.decodeAudioData(O(n,r,i),function(n){var a=e.createBufferSource();a.buffer=n,a.connect(t);var i=t.fftSize,r=new Uint8Array(i);t.getByteFrequencyData(r),a.start(),c(r)})})},_=function(e,t,n,a,i,r,c){a.fillRect(0,0,i,r),a.beginPath();for(var o,s=e.length,m=i/s*2.5,l=0,f=0;f<s;f++)o=e[f],a.fillStyle=c.strokeStyle,a.fillRect(l,r-o,m,o),l+=m+1;a.fillStyle=c.fillStyle},k=Object(m.b)(l.c,Object(l.b)("store"),Object(m.a)(function(e){var t=e.navigatorMicStream;return p.a(t)},m.f),Object(m.h)(function(e){var t=e.color,n=e.store,a=(n.spectrumInfo,n.config);return{styles:{fillStyle:"white",strokeStyle:t,lineWidth:1},fftSize:256,rate:a.mic.rate,channels:a.mic.channels,minRateDif:a.minRateDif}}),Object(m.c)({componentDidMount:function(){var e=this,t=this.props,n=t.navigatorMicStream,a=t.fftSize,i=t.channels,r=t.rate,c=t.store,o=(t.minRateDif,new(window.AudioContext||window.webkitAudioContext)),s=o.createAnalyser(),m=document.querySelector(".frequency-bars"),l=m.width,f=m.height,u=m.getContext("2d");u.clearRect(0,0,m.width,m.height),n.on("data",function(){var t=Object(w.a)(g.a.mark(function t(n){var m;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(o,s,n,a,r,i);case 2:m=t.sent,_(m,c.spectrumInfo,0,u,l,f,e.props.styles),c.spectrumInfo.setMean(m);case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),n.on("error",alert)}}),Object(m.d)(o.a({frequencyHeight:s.a(["store","windowInfo","frequencyHeight"]),frequencyWidth:s.a(["store","windowInfo","frequencyWidth"])})))(function(e){var t=e.frequencyHeight,n=e.frequencyWidth;return i.a.createElement("div",{className:"d-flex flex-row"},i.a.createElement("canvas",{className:"frequency-bars",width:n,height:t}))}),S=n(149),N=n(13),E=n(24),T=n(76),I=n(77),C=(n(71),Object(m.b)(Object(l.b)("store"),Object(m.j)("micRate","setMicRate",100),Object(m.i)(["micRate"],function(e){var t=e.micRate,n=e.socket,a=e.store;n.emit("micRate",{micRate:parseInt(t)}),a.spectrumInfo.refreshListening()}))(function(e){var t=e.micRate,n=e.setMicRate;return i.a.createElement("div",{className:"d-flex flex-row"},i.a.createElement("p",{className:"icon-container"},i.a.createElement(T.a,{icon:I.a,className:"icon"})),i.a.createElement("p",{className:"indicator"},"-"),i.a.createElement("div",{className:"range-container"},i.a.createElement(E.Range,{step:1,min:0,max:100,values:[t],onChange:function(e){return n(e[0])},renderTrack:function(e){var n=e.props,a=e.children;return i.a.createElement("div",Object.assign({},n,{style:Object(N.a)({},n.style,{background:Object(E.getTrackBackground)({values:[t],colors:["#000000","#aaa"],min:0,max:100})}),className:"line"}),a)},renderThumb:function(e){var t=e.props,n=e.isDragged;return i.a.createElement("div",Object.assign({},t,{className:"toggle",style:Object(N.a)({},t.style)}),i.a.createElement("div",{className:"circle-container"},i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," "),i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," "),i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," ")))}})),i.a.createElement("p",{className:"indicator"},"+"))})),U=Object(m.b)(Object(l.b)("store"),Object(m.j)("rate","setRate",function(e){var t=e.store;return[t.config.minRateDif,t.config.maxRateDif]}),Object(m.i)(["rate"],function(e){var t=e.rate,n=e.store;n.config.setRate(t[0],t[1]),n.spectrumInfo.changeConfig({minRateDif:t[0]})}))(function(e){var t=e.rate,n=e.setRate;return i.a.createElement("div",{className:"d-flex flex-row"},i.a.createElement("p",{className:"indicator"},"0"),i.a.createElement("div",{className:"range-container"},i.a.createElement(E.Range,{step:5,min:0,max:100,values:t,onChange:n,renderTrack:function(e){var n=e.props,a=e.children;return i.a.createElement("div",{onMouseDown:n.onMouseDown,onTouchStart:n.onTouchStart,style:Object(N.a)({},n.style,{background:Object(E.getTrackBackground)({values:t,colors:["#aaa","#000000","#aaa"],min:0,max:100})}),className:"line"},i.a.createElement("div",{ref:n.ref},a))},renderThumb:function(e){var t=e.props,n=e.isDragged;return i.a.createElement("div",Object.assign({},t,{style:Object(N.a)({},t.style),className:"toggle"}),i.a.createElement("div",{className:"circle-container"},i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," "),i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," "),i.a.createElement("div",{className:"circle ".concat(n?"active":"")}," ")))}})),i.a.createElement("p",{className:"indicator"},"100"))}),B=Object(m.b)(Object(l.b)("store"),Object(m.d)(o.a({spectrumInfo:s.a(["store","spectrumInfo"]),config:s.a(["store","config"]),distance:S.a(o.a({min:s.a(["store","config","minRateDif"]),max:s.a(["store","config","maxRateDif"]),ratting:s.a(["store","spectrumInfo","meanOfBreathR"])}),function(e){return function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6;if(n<e)return null;if(n>t)return 0;var i=(t-n)/((t-e)/a);return Math.round(i)}(e.min,e.max,e.ratting||0)}),socket:s.a(["socket"])})))(Object(l.c)(function(e){var t=e.spectrumInfo,n=e.config,a=e.distance,r=e.socket;return i.a.createElement("div",{className:"d-flex flex-column align-items-t flex-fill"},i.a.createElement("h1",{className:"text-center",style:{color:t.color}},null!==a?"".concat(a," mm"):"-"),i.a.createElement(C,{socket:r}),t.timeLeft<=0?i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex flex-column "},i.a.createElement("h3",{className:"text-center"},i.a.createElement("small",{className:"text-muted"},"Spectrum: "),t.meanOfBreath," / ",t.mean," = ",t.meanOfBreathR," %"),i.a.createElement("h5",{className:"text-center"},i.a.createElement("small",{className:"text-muted"},"Range: "),n.minRateDif,"  / ",n.maxRateDif),i.a.createElement(U,null))):i.a.createElement("div",{className:"flex-fill d-flex flex-column"},i.a.createElement("h1",{className:"text-center"},t.timeLeft)))})),W=Object(l.b)("store")(B),A=(n(142),Object(m.b)(Object(l.b)("store"),Object(m.d)(o.a({windowInfo:s.a(["store","windowInfo"])})),Object(m.g)({onInteractWithWindowClick:function(e){var t=e.windowInfo;return function(){return t.interactWithWindow()}}}))(function(e){var t=e.onInteractWithWindowClick;return i.a.createElement("div",{onClick:t,className:"interact-window"},i.a.createElement("p",{onClick:t},"Tab to Start"))})),L=(n(144),"".concat(window.location.hostname,":").concat(window.location.port)),M=d()(L),q=Object(m.b)(Object(m.a)(function(e){return!e.windowInfo.isInteracted},Object(m.e)(A)))(Object(l.c)(function(e){var t=e.navigatorMicStream,n=e.spectrumInfo,a=e.config;return i.a.createElement("div",{className:"container-fluid",style:{padding:10}},a.mic.rate&&i.a.createElement(R,{navigatorMicStream:t,color:n.color}),i.a.createElement("div",{className:"d-flex flex-row"},i.a.createElement(W,{socket:M}),a.mic.rate&&i.a.createElement(k,{navigatorMicStream:t,color:n.color,socket:M})))})),H=Object(m.b)(l.c,Object(l.b)("store"),Object(m.d)(o.a({spectrumInfo:s.a(["store","spectrumInfo"]),windowInfo:s.a(["store","windowInfo"]),config:s.a(["store","config"])})),Object(m.j)("navigatorMicStream","setStream",null),Object(m.c)({componentDidMount:function(){var e=this;this.props.windowInfo.init(),this.props.config.setUrl(L),u()(M).on("mic-stream",function(t,n){var a=n.mic,i=n.minRateDif,r=n.minBreathTime,c=n.maxRateDif;e.props.setStream(t),e.props.config.setRate(i,c),e.props.config.setMinBreathTime(r),e.props.config.setMic(a.rate,a.channels,a.device),e.props.spectrumInfo.changeConfig({minRateDif:i,minBreathTime:r}),e.props.spectrumInfo.saveSocket(M)})}}))(Object(l.c)(q));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=n(150),P=n(22),F=n(136),V=n(5),J=n(78),$=n(79),G=null,K=function(){G||(G=function(){var e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator();return t.type="square",t.frequency.setValueAtTime(2e3,e.currentTime),t.connect(e.destination),t}()).start()},Q=function(){function e(t){Object(J.a)(this,e),this._socket=null,this._statOfListen=null,this._isListening=!0,this._time=t.timeToListen,this._minBreathTime=t.minBreathTime,this._minRateDif=t.minRateDif,this._lastColorNotificationDate=null,this._lastSoundNotificationDate=null,this._lastSercerNotificationDate=null,this._means=[],this._mean=0,this._maxes=[],this._max=0,this.listen=this.listen.bind(this)}return Object($.a)(e,[{key:"saveSocket",value:function(e){this._socket=e}},{key:"changeConfig",value:function(e){this._time=e.timeToListen||this._time,this._minBreathTime=e.minBreathTime||this._minBreathTime,this._minRateDif=e.minRateDif||this._minRateDif}},{key:"refreshListening",value:function(){this._isListening=!0,this._statOfListen=(new Date).getTime()}},{key:"listen",value:function(e,t){if(this._isListening){this._statOfListen=this._statOfListen||(new Date).getTime();var n=((new Date).getTime()-this._statOfListen)/1e3,a=parseInt(n,10)-1;a<0||(this._means[a]=this._means[a]||[],this._maxes[a]=this._maxes[a]||[],this._means[a].push(e),this._maxes[a].push(t),n>this._time&&(this._isListening=!1,this._mean=z.a(this._means.map(P.a(F.a,0))),this._max=z.a(this._maxes.map(P.a(F.a,0)))))}}},{key:"getMean",value:function(){return this._mean}},{key:"getMax",value:function(){return this._max}},{key:"getTimeLeft",value:function(){if(!this._isListening)return 0;var e=((new Date).getTime()-this._statOfListen)/1e3;return this._time-parseInt(e,10)}},{key:"getColor",value:function(e){if(this._isListening)return"#c6c8ca";this._lastColorNotificationDate=this._lastColorNotificationDate||(new Date).getTime();var t=(new Date).getTime()-this._lastColorNotificationDate;return e>this._minRateDif&&t>=this._minBreathTime?"rgb(255, ".concat(155-(e+15)||0,",  ").concat(155-(e+15)||0,")"):"black"}},{key:"soundNotify",value:function(e){this._lastSoundNotificationDate=this._lastSoundNotificationDate||(new Date).getTime();var t=(new Date).getTime()-this._lastSoundNotificationDate;return e>this._minRateDif&&t>=this._minBreathTime?K():(G&&G.stop(),void(G=null))}},{key:"serverNotify",value:function(e){this._lastSercerNotificationDate=this._lastSercerNotificationDate||(new Date).getTime();var t=(new Date).getTime()-this._lastSercerNotificationDate;return e>this._minRateDif&&t>=this._minBreathTime?(this._lastSercerNotificationDate=(new Date).getTime(),this._socket.emit("rln-type",{type:"nerve"})):e>1&&t>=this._minBreathTime?(this._lastSercerNotificationDate=(new Date).getTime(),this._socket.emit("rln-type",{type:"muscle"})):void 0}}]),e}(),X={timeToListen:10,minRateDif:50,maxRateDif:90,sinewaveScale:1.9,minBreathTime:100},Y=V.a.model("SpectrumInfo",{mic:V.a.frozen({rate:V.a.number,channels:V.a.number,device:V.a.string}),url:V.a.string,timeToListen:V.a.number,minRateDif:V.a.number,maxRateDif:V.a.number,sinewaveScale:V.a.number,minBreathTime:V.a.number}).actions(function(e){return{setMic:function(t,n,a){e.mic={rate:t,channels:n,device:a}},setUrl:function(t){e.url=t},setRate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.minRateDif,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.maxRateDif;e.minRateDif=t,e.maxRateDif=n},setMaxRateDif:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.maxRateDif;e.maxRateDif=t},setMinBreathTime:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.minBreathTime;e.minBreathTime=t}}}).create(Object(N.a)({mic:{rate:0,channels:0,device:1},url:""},X)),Z=new Q(X),ee={spectrumInfo:V.a.model("SpectrumInfo",{mean:V.a.number,max:V.a.number,meanOfBreath:V.a.number,meanOfBreathR:V.a.number,timeLeft:V.a.number,color:V.a.string}).actions(function(e){return{saveSocket:function(e){Z.saveSocket(e)},refreshListening:function(){Z.refreshListening()},setMean:function(t){if(e.mean=parseInt(z.a(t),10),e.max=P.a(F.a,0,t),Z.listen(e.mean,e.max),e.meanOfBreath=Z.getMean(),e.timeLeft=Z.getTimeLeft(),e.meanOfBreath){var n=100-e.mean,a=100-e.meanOfBreath,i=parseInt(100-100*n/a,10)||0;a>n&&(e.meanOfBreathR=i,e.meanOfBreathR=e.meanOfBreathR>0?e.meanOfBreathR:0)}e.color=Z.getColor(e.meanOfBreathR),e.meanOfBreathR&&(Z.soundNotify(e.meanOfBreathR),Z.serverNotify(e.meanOfBreathR))},changeConfig:function(e){Z.changeConfig(e)}}}).create({mean:0,max:0,meanOfBreath:0,meanOfBreathR:0,timeLeft:-1,color:"black"}),windowInfo:V.a.model("WindowInfo",{sineWaveHeight:V.a.number,frequencyHeight:V.a.number,sineWaveWidth:V.a.number,frequencyWidth:V.a.number,isInteracted:V.a.boolean}).actions(function(e){return{init:function(){var t=window.innerHeight;e.sineWaveHeight=.4*t,e.frequencyHeight=.7*t,e.sineWaveWidth=window.innerWidth,e.frequencyWidth=window.innerWidth/2},interactWithWindow:function(){e.isInteracted=!0}}}).create({sineWaveHeight:0,frequencyHeight:0,sineWaveWidth:0,frequencyWidth:0,isInteracted:!1}),config:Y};c.a.render(i.a.createElement(l.a,{store:ee},i.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},71:function(e,t,n){},81:function(e,t,n){e.exports=n(146)},93:function(e,t){},95:function(e,t){}},[[81,2,1]]]);
//# sourceMappingURL=main.c587866e.chunk.js.map